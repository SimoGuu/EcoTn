<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Silex v3.6.1">
    <link rel="stylesheet" href="css/news.css" />
    <link rel="stylesheet" href="css/style.css"/>




    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
</head>

<body class="sfondo">
    <div class="titolo_block"  data-lingua="titolo_news" ></div>
    
        
            <div id="div_chiavi"  >
                <p class="testo_impostazioni" data-lingua="input_chiavi"></p>
                <input type="text" id="txt_chiave" />
            </div>
           
        
    <div class="box_news" id="box_news">
        <div  class="card">
            <img  src="/assets/impianto_placeholder.jpg" />
            <div>
                <div class="testo_impostazioni titolo_news">Titolo News</div>
            </div>

            <div class="testo_impostazioni titolo_chiavi" data-lingua="chiavi_card" ></div>
            <div  class="elenco_chiavi">#Ecologia #Eolico<br id="izf9uc" /></div>
        </div>
    </div>

    <script src="scripts/translations.js"></script>
    <script>
        let apiUrl = (window.location.hostname === "localhost") ? "http://localhost:8080" : "https://ecotn-xum1.onrender.com";

        cambiaLingua();
        //Set tema
        if (localStorage.getItem("theme") == "dark") {
            document.body.classList.add("dark");
        } else {
            document.body.classList.remove("dark");
        }


        getNews();
    // Funzione per ottenere le case dal backend
    async function getNews() {
        try {
            let url = "/api/v1/news";
            if (document.getElementById("txt_chiave").value == "" ) {
                url = url + "/" + document.getElementById("txt_chiave").value;
            }
            const response = await fetch(apiUrl + "/api/v1/news");

            // Controlla se la risposta Ã¨ OK
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            // Trasforma la risposta in JSON
            const notizie = await response.json();

            // Stampa in console (o fai quello che vuoi con i dati)
            console.log(notizie);

            // Se vuoi, puoi anche popolare il DOM
            displayNotizie(notizie);

        } catch (error) {
            console.error("Errore nel recupero delle case:", error);
        }
    }

    //Funzione di esempio per mostrare le case nella pagina
    function displayNotizie(notizie) {
        const container = document.getElementById("box_news");
        container.innerHTML = ""; // pulisce eventuali contenuti precedenti

        notizie.forEach(notizia => {


            const div = document.createElement("div");
            div.classList.add("card");
            div.id = `abitazione-${notizia._id}`;

            div.addEventListener('click', function () {

                
                localStorage.setItem('idNotizia', notizia._id);
                window.location.href = 'articolo.html';

            });

            var immagine = document.createElement("img");
            immagine.classList.add("img_news");

            //const source = house.immagineProfilo === undefined ? "Immagini/Icone_meteo/icona_sole_nuvoloso.png" : house.immagineProfilo;
            const source = "Immagini/impianto_placeholder.jpg";
            immagine.src = source;


            immagine.alt = "Immagini/Icone_meteo/icona_sole_nuvoloso.png";

            var titolo = document.createElement("h2");
            titolo.textContent = `${notizia.titolo}`;
            
            /*
            var indirizzo = document.createElement("p");
            indirizzo.classList.add("nome_impianto");
            indirizzo.textContent = `${house.indirizzo}`;
            div.appendChild(indirizzo);
            */

            div.appendChild(titolo);
            div.appendChild(immagine);

            

            container.appendChild(div);
        });
    }

    </script>
</body>

</html>