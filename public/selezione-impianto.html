<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Silex v3.6.1">
    <link rel="stylesheet" href="css/selezione-impianto.css" />
    <link rel="stylesheet" href="css/style.css" />





    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
</head>

<body class="sfondo">

    <div class="titolo_block" data-lingua="titolo_selezione"></div>

    <!--
    <div class="container_impianto">
        <img class="immagine_impianto" src="Immagini/Icone_meteo/icona_sole_nuvoloso.png" />
        <div class="nome_impianto">NOME IMPIANTO</div>
    </div>

    -->
    <div id="housesContainer"></div>


</body>

<script src="scripts/translations.js"></script>
<script>

    cambiaLingua();
    //Set tema
    if (localStorage.getItem("theme") == "dark") {
        document.body.classList.add("dark");
    } else {
        document.body.classList.remove("dark");
    }


    getHouses();
    // Funzione per ottenere le case dal backend
    async function getHouses() {
        try {
            // Chiamata all'API completa con URL assoluto
            const response = await fetch("http://localhost:8080/api/v1/houses");

            // Controlla se la risposta Ã¨ OK
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            // Trasforma la risposta in JSON
            const houses = await response.json();

            // Stampa in console (o fai quello che vuoi con i dati)
            console.log(houses);

            // Se vuoi, puoi anche popolare il DOM
            displayHouses(houses);

        } catch (error) {
            console.error("Errore nel recupero delle case:", error);
        }
    }

    //Funzione di esempio per mostrare le case nella pagina
    function displayHouses(houses) {
        const container = document.getElementById("housesContainer");
        container.innerHTML = ""; // pulisce eventuali contenuti precedenti

        houses.forEach(house => {


            const div = document.createElement("div");
            div.classList.add("container_impianto");
            div.id = `abitazione-${house._id}`;

            div.addEventListener('click', function () {

                
                localStorage.setItem('idAbitazione', house._id);
                localStorage.setItem('indirizzoAbitazione', house.indirizzo);
                window.location.href = 'pagina-impianto.html';

            });

            var immagine = document.createElement("img");
            immagine.classList.add("immagine_impianto");

            //const source = house.immagineProfilo === undefined ? "Immagini/Icone_meteo/icona_sole_nuvoloso.png" : house.immagineProfilo;
            const source = "Immagini/impianto_placeholder.jpg";
            immagine.src = source;


            immagine.alt = "Immagini/Icone_meteo/icona_sole_nuvoloso.png";

            var titolo = document.createElement("h2");
            titolo.textContent = `${house.indirizzo}`;
            
            /*
            var indirizzo = document.createElement("p");
            indirizzo.classList.add("nome_impianto");
            indirizzo.textContent = `${house.indirizzo}`;
            div.appendChild(indirizzo);
            */

            div.appendChild(titolo);
            div.appendChild(immagine);

            

            container.appendChild(div);
        });
    }


</script>

</html>